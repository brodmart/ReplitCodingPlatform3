
{% extends "base.html" %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/editor/editor.main.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/editor.js') }}"></script>
{% endblock %}

{% block content %}
<!-- Your existing content -->
{% endblock %}

{% block extra_scripts %}
<script>
let editor = null;

function initializeEditor() {
    if (editor) return;

    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
    require(['vs/editor/editor.main'], function() {
        const editorElement = document.getElementById('editor');
        if (!editorElement) return;

        const code = {{ activity.starter_code|tojson|safe }};
        const language = '{{ activity.language }}';
        
        editor = monaco.editor.create(editorElement, {
            value: code || '',
            language: language || 'cpp',
            theme: 'vs-dark',
            readOnly: false,
            wordWrap: 'on',
            minimap: { enabled: true }
        });

        window.activityEditor = editor;
        window.codeEditor = editor;

        if (typeof setupEventHandlers === 'function') setupEventHandlers(editor);
        if (typeof setupValidation === 'function') setupValidation(editor);
    });
}

// Initialize editor when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    initializeEditor();
    
    // Initialize Bootstrap tooltips
    if (typeof bootstrap !== 'undefined') {
        const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltips.forEach(tooltip => new bootstrap.Tooltip(tooltip));
    }
});
</script>
{% endblock %}

{% extends "base.html" %}

{% block head %}
<!-- CodeMirror CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
<style>
    .tutorial-container {
        display: flex;
        gap: 20px;
        height: calc(100vh - 200px);
    }

    .tutorial-sidebar {
        width: 300px;
        background: #2d2d2d;
        border-radius: 8px;
        padding: 20px;
        overflow-y: auto;
    }

    .tutorial-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .step-indicator {
        display: flex;
        margin-bottom: 20px;
        padding: 10px;
        background: #1e1e1e;
        border-radius: 4px;
    }

    .step-dot {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #3d3d3d;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        position: relative;
    }

    .step-dot.active {
        background: #0d6efd;
        color: white;
    }

    .step-dot.completed {
        background: #198754;
        color: white;
    }

    .step-dot.completed::after {
        content: '✓';
    }

    .step-connector {
        flex: 1;
        height: 2px;
        background: #3d3d3d;
        margin: auto 5px;
    }

    .tutorial-instruction {
        background: #2d2d2d;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .instruction-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }

    .instruction-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #0d6efd;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
    }

    .code-hint {
        background: #1e1e1e;
        border-left: 3px solid #0d6efd;
        padding: 10px;
        margin: 10px 0;
        font-family: monospace;
    }

    .editor-container {
        flex: 1;
        position: relative;
        border-radius: 8px;
        overflow: hidden;
    }

    .validation-message {
        position: absolute;
        bottom: 20px;
        right: 20px;
        padding: 10px 20px;
        border-radius: 4px;
        display: none;
    }

    .validation-message.success {
        background: rgba(25, 135, 84, 0.9);
        display: block;
    }

    .validation-message.error {
        background: rgba(220, 53, 69, 0.9);
        display: block;
    }

    .tutorial-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
        padding: 10px;
        background: #2d2d2d;
        border-radius: 8px;
    }

    .nav-button {
        padding: 8px 16px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .progress-bar {
        height: 4px;
        background: #3d3d3d;
        margin: 20px 0;
        border-radius: 2px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: #0d6efd;
        transition: width 0.3s ease;
    }

    .console-container {
        display: flex;
        flex-direction: column;
        height: 150px; /* Adjust as needed */
        overflow-y: auto;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 10px;
    }

    .console-output {
        white-space: pre-wrap;
        flex: 1;
        margin-bottom: 5px;
    }

    .console-input-line {
        display: flex;
        align-items: center;
    }

    .console-prompt {
        margin-right: 5px;
    }

    .console-input-field {
        flex: 1;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="tutorial-container">
        <!-- Tutorial Sidebar -->
        <div class="tutorial-sidebar">
            <h4>{{ tutorial.title }}</h4>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ progress }}%"></div>
            </div>
            <div class="steps-list">
                {% for step in tutorial.steps %}
                <div class="step-item {% if loop.index0 == current_step %}active{% endif %} 
                                   {% if loop.index0 < current_step %}completed{% endif %}">
                    <div class="step-number">{{ loop.index }}</div>
                    <div class="step-title">{{ step.title }}</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Tutorial Content -->
        <div class="tutorial-content">
            <!-- Step Indicator -->
            <div class="step-indicator">
                {% for i in range(tutorial.steps|length) %}
                <div class="step-dot {% if i == current_step %}active{% endif %} 
                                   {% if i < current_step %}completed{% endif %}">
                    {{ i + 1 }}
                </div>
                {% if not loop.last %}
                <div class="step-connector"></div>
                {% endif %}
                {% endfor %}
            </div>

            <!-- Current Step Instructions -->
            <div class="tutorial-instruction">
                <div class="instruction-header">
                    <div class="instruction-number">{{ current_step + 1 }}</div>
                    <h5 class="mb-0">{{ current_instruction.title }}</h5>
                </div>
                <p>{{ current_instruction.description }}</p>
                {% if current_instruction.hint %}
                <div class="code-hint">
                    <i class="bi bi-lightbulb me-2"></i>{{ current_instruction.hint }}
                </div>
                {% endif %}
            </div>

            <!-- Code Editor -->
            <div class="editor-container">
                <textarea id="editor">{{ current_instruction.starter_code }}</textarea>
                <div class="validation-message">
                    <i class="bi bi-check-circle me-2"></i>
                    <span class="message-text"></span>
                </div>
            </div>
            <div class="console-container">
                <div id="consoleOutput" class="console-output"></div>
                <div class="console-input-line">
                    <span class="console-prompt">&gt;</span>
                    <input type="text" id="consoleInput" class="console-input-field" 
                           placeholder="{% if lang == 'fr' %}Appuyez sur Entrée pour envoyer{% else %}Press Enter to send{% endif %}"
                           autocomplete="off">
                </div>
            </div>

            <!-- Navigation -->
            <div class="tutorial-navigation">
                <button class="nav-button btn btn-secondary" id="prevStep" {% if current_step == 0 %}disabled{% endif %}>
                    <i class="bi bi-arrow-left"></i> Previous
                </button>
                <button class="nav-button btn btn-primary" id="nextStep">
                    {% if current_step == tutorial.steps|length - 1 %}
                        Complete <i class="bi bi-check-circle"></i>
                    {% else %}
                        Next <i class="bi bi-arrow-right"></i>
                    {% endif %}
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- CodeMirror Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
<script src="{{ url_for('static', filename='js/tutorial.js') }}"></script>
{% endblock %}